# yet-another-teensy-makefile

Title says it all.

Unique selling points and other facts:

- Supports GNU/Linux only

- Works (more or less) with the command lines used by the Arduino
  IDE and, hence, creates hex files comparable to those created
  by the IDE

- Comes with instructions and procedures to set up a minimum
  Teensy working environment from a full Arduino and Teensyduino
  installation

- Tested with Arduino 1.8.10, Teensyduino 1.48, and Teensy 3.5

- Tested on Debian "stretch"

- Based on and inspired by
  https://github.com/apmorton/teensy-template and the makefile
  that comes with Teensyduino itself

# Installation

### Directory Structure

The installation instructions below assume the following
directory structure:

- `arduino-base-dir` contains a full Arduino and Teensyduino
  installation
  
- `teensy-base-dir` contains a minimum Teensy working environment
  consisting of some Teensyduino-specific tools and sources

- `project-base-dir` contains your Teensy project sources

You can use one directory both as Teensy base directory and
project base directory, but should keep in mind that the
installation instructions below completely recreate
`teensy-base-dir`, discarding any previous contents.

If you have these directories already set up in some different
fashion, feel free to skip below installation instructions and
update the variables tagged "installation-time variables" in the
makefile directly as needed.

### Installation Instructions

- Install Arduino and Teensyduino into the Arduino base directory
  `arduino-base-dir` according to their respective installation
  instructions.

- Create the Teensy base directory `teensy-base-dir` and prepare
  the project base directory `project-base-dir` with the
  following make invocation:
  
  ```
    make -f <path-to-the-makefile>                \
            ARDUINO_BASE_DIR=<arduino-base-dir>   \
            TEENSY_BASE_DIR=<teensy-base-dir>     \
            PROJECT_BASE_DIR=<project-base-dir>   \
            install
  ```

  where all `*-base-dir` placeholders must be specified as
  absolute directory paths, like in the following example:
  
  ```
    make -f ~/git/yet-another-teensy-makefile/GNUmakefile \
            ARDUINO_BASE_DIR=~/arduino-1.8.10             \
            TEENSY_BASE_DIR=~/teensy-test                 \
            PROJECT_BASE_DIR=~/teensy-projects            \
            install
  ```

  Target `install` copies the following files and directories
  from the Arduino base directory to the newly created Teensy
  base directory:
  
  ```
    examples/Teensy
    hardware/teensy/avr
    hardware/tools/arm          # disable with NO_TEENSY_TOOLS=1
    hardware/tools/teensy*      # disable with NO_TEENSY_TOOLS=1
  ```

  In addition, target `install` copies the makefile to the
  project base directory, overwriting any other file named
  `GNUmakefile` there, and configures the installation-time
  variables in it.

- (If you have specified `NO_TEENSY_TOOLS=1` above:)  
  Install Debian packages `gcc-arm-none-eabi`,
  `libnewlib-arm-none-eabi`, `libstdc++-arm-none-eabi-newlib` (or
  comparable packages on other distros).

- (If you have specified `NO_TEENSY_TOOLS=1` above:)  
  Build `teensy_loader_cli` from
  https://github.com/PaulStoffregen/teensy_loader_cli and copy it
  to `<teensy-base-dir>/hardware/tools`.

# Motivation for This Project

I dislike IDEs other than the One.  Plus the other existing
Teensyduino-replacing-makefiles were out-of-date and produced hex
files which were larger and different in structure compared to
those generated by the IDE.  So after some fiddeling I decided to
use `strace` on the Arduino IDE, extract the command lines from
that, and put some makefile around them.
